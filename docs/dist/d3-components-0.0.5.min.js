/*! D3 Components v0.0.5 | (c) 2017 Zan Pan | MIT license */
d3.components={},d3.defaultOptions={id:"chart",renderer:"svg",standalone:!0,responsive:!0,width:400,height:250,aspectRatio:.618034,color:"#1f77b4",colorScheme:d3.schemeCategory10,stroke:"none",strokeWidth:1,fontSize:14,lineHeight:20,title:{show:!1,x:"50%",y:"1.6em",height:"2em",wrapText:!0,wrapWidth:"90%",lineHeight:"2em",stroke:"none",fill:"currentColor",fontSize:"1.4em",fontWeight:"bold",textAnchor:"middle",text:""},tooltip:{show:!0,autoplay:!1,carousel:{delay:2e3,interval:2e3},html:function(t,e){return"Datum "+e},style:{display:"none",boxSizing:"border-box",position:"absolute",pointerEvents:"none",padding:"0.2em 0.6em",backgroundColor:"#fff",border:"1px solid #999",borderRadius:"0.2em",color:"#333",fontSize:"85%",opacity:.8}},legend:{autoplay:!1,carousel:{delay:2e3,interval:2e3},type:"checkbox",display:"block",maxWidth:"6.8em",columns:5,symbol:{shape:"rect",width:"0.8em",height:"0.8em"},dx:"0.4em",transform:"scale(0.85)",lineHeight:"1.6em",textColor:"currentColor",disabledTextColor:"#ccc",key:function(t,e){return e}},axisX:{show:!0,orient:"bottom",ticks:{number:8,sizeInner:6,sizeOuter:0,padding:4},domain:{show:!0,stroke:"currentColor",strokeWidth:1},fontSize:"0.85em",stroke:"currentColor",fill:"currentColor"},axisY:{show:!0,orient:"left",ticks:{number:6,sizeInner:6,sizeOuter:0,padding:4},domain:{show:!0,stroke:"currentColor",strokeWidth:1},fontSize:"0.85em",stroke:"currentColor",fill:"currentColor"},gridX:{show:!1,stroke:"#ccc",strokeDash:[6,4]},gridY:{show:!1,stroke:"#ccc",strokeDash:[6,4]},labelX:{show:!1,text:"X",dy:"2.8em",fill:"currentColor",textAnchor:"end"},labelY:{show:!1,text:"Y",dy:"-3em",fill:"currentColor",textAnchor:"end",transform:"rotate(-90)"}},d3.createChart=function(t){if("object"===d3.type(t)){var e=d3[t.type];if("function"===d3.type(e))if(t.reload===!0){var r=Number(t.interval);t.reload=!1,d3.interval(function(){d3.createChart(t)},r)}else{var a=t.data,n=t.options,i=d3.type(a);if("string"===i)d3.json(a,function(t){return e(t,n)});else{if("object"!==i||!a.api)return e(a,n);var o=a.type,l=a.api;if("json"===o)d3.json(l,function(t){return e(t,n)});else if("csv"===o){var s=a.row||function(t){return t};d3.csv(l,s,function(t){return e(t,n)})}}}}},d3.parseData=function(t,e){var r=d3.components[t],a=r.schema||{},n=a.hierarchy,i=d3.type(e);if("array"===i){if(e=e.filter(function(t){return null!==t&&void 0!==t}).map(function(e,r){return Array.isArray(e)?(e=e.map(function(t){return t.hasOwnProperty("series")||(t.series=String(r)),t}),d3.parseData(t,e)):"object"!==d3.type(e)?{index:String(r),value:e}:e}),"object"===a.type)if(Array.isArray(a.mappings)){var o=a.entries,l=a.mappings,s=Object.keys(l);e.forEach(function(t){s.forEach(function(e){var r=l[e];o.some(function(a){if(a.key===e){var n=a.type,i=t[r];return"string"===n?i=String(i):"number"===n?i=Number(i):"date"===n&&(i=new Date(i)),t[e]=i,!0}return!1})})})}else{var o=a.entries;e.forEach(function(e){var r=Object.keys(e);o.forEach(function(a){var i=a.key,o=a.type,l=null;if(e.hasOwnProperty(i))i===n&&"array"===o&&(e[n]=d3.parseData(t,e[n])),r.splice(r.indexOf(i),1),l=i;else{var s=a.aliases||[];s.some(function(t){var e=r.indexOf(t);return e!==-1&&(r.splice(e,1),l=t,!0)}),null===l&&r.some(function(t){return d3.type(e[t])===o&&(r.splice(r.indexOf(t),1),l=t,!0)})}if(l){var c=e[l];"string"===o?c=String(c):"number"===o?c=Number(c):"date"===o&&(c=new Date(c)),e[i]=c}})})}return[].concat.apply([],e)}return"object"===i?d3.parseData(t,[e])[0]:e},d3.parseOptions=function(t,e){var r=d3.components[t];e=d3.extend(r,e);var a=d3.defaultOptions,n=e.id||a.id,i=d3.select("#"+n);if(a.responsive&&!e.hasOwnProperty("responsive")){if(!e.hasOwnProperty("width")){var o=parseInt(i.style("width"))||a.width;e.width=Math.round(o)}if(!e.hasOwnProperty("height")){var l=e.aspectRatio||a.aspectRatio,s=parseInt(i.style("height"))||e.width*l;e.height=Math.round(s)}e.hasOwnProperty("fontSize")||(e.fontSize=parseInt(i.style("font-size"))),e.hasOwnProperty("lineHeight")||(e.lineHeight=parseInt(i.style("line-height")))}e=d3.extend(a,e);var c=i.node(),d=d3.extend({id:n+"-tooltip"},e.tooltip);if(e.tooltip=d,c.style.position="relative",d.show){var u=d.id,p=d.style,h=d3.select("#"+u).node();if(null===h){h=document.createElement("div"),h.id=u,h.className="tooltip";for(var f in p)p.hasOwnProperty(f)&&(h.style[f]=p[f]);"CANVAS"===c.tagName?c.parentNode.insertBefore(h,c):c.appendChild(h)}}e.chart=c,"CANVAS"===c.tagName&&(e.renderer="canvas",i=c),"canvas"===e.renderer?("CANVAS"!==c.tagName&&(i=document.createElement("canvas"),c.appendChild(i)),i.width=e.width,i.height=e.height,e.context=i.getContext("2d")):e.context=null;for(var f in e)e.hasOwnProperty(f)&&(e[f]=d3.parseValue(e[f],e));if(e.hasOwnProperty("map")){var m=e.map||{},g=m.name||"world";e.map=d3.extend(d3.mapData[g],m)}var y=e.fontSize,v=e.lineHeight,x=d3.extend({top:v,right:2*y,bottom:2*v,left:4*y},e.margin);return e.margin=x,e.innerWidth=e.width-x.left-x.right,e.innerHeight=e.height-x.top-x.bottom,e},d3.parseValue=function(t,e){var r=d3.type(t);if("object"===r)for(var a in t)t.hasOwnProperty(a)&&(t[a]=d3.parseValue(t[a],e));else if("string"===r)if(/^\-?\d+\.?\d*(px)$/.test(t))t=Number(t.replace("px",""));else if(/^\-?\d+\.?\d*(em)$/.test(t))e.hasOwnProperty("fontSize")&&(t=Number(t.replace("em",""))*e.fontSize);else if(/^\-?\d+\.?\d*\%$/.test(t))e.hasOwnProperty("width")&&(t=Number(t.replace("%",""))*e.width/100);else if(/^(a|de)scending\(\w+\)$/.test(t)){var n=t.split(/\W/),i=n[0],a=n[1];t=function(t,e){var r="ascdending"===i?-1:1;return t.hasOwnProperty(a)&&e.hasOwnProperty(a)?void 0===t[a]||null===t[a]?r:d3[i](t[a],e[a])||-r:t.data&&e.data?void 0==t.data[a]||null===t.data[a]?r:d3[i](t.data[a],e.data[a])||-r:0}}return t},d3.type=function(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()},d3.extend=function(t,e){var r={};if("object"===d3.type(t))for(var a in t)if(t.hasOwnProperty(a)){var n=t[a];"object"===d3.type(n)&&(n=d3.extend(r[a],n)),r[a]=n}if("object"===d3.type(e))for(var a in e)if(e.hasOwnProperty(a)){var n=e[a];"object"===d3.type(n)&&(n=d3.extend(r[a],n)),r[a]=n}return r},d3.formatString=function(t,e){var r=String(t),a=d3.type(e);if("object"===a){var n=/\$\{\s*([^\{\}\s]+)\s*\}/g,i=r.match(n)||[];i.forEach(function(t){var a=t.replace(n,"$1"),i=e[a];if("object"===d3.type(i)){var o=String(a).replace(/\[([^\]]+)\]/g,".$1").split(".");o.every(function(t){return!("object"!==d3.type(i)||!i.hasOwnProperty(t))&&(i=i[t],!0)})}r=r.replace(t,function(){return i})})}return r},d3.translate=function(t,e){return"translate("+t+","+e+")"},d3.regularPolygon=function(t,e){var r=2*Math.PI/t;return d3.range(t).map(function(t){var a=r*t;return[e*Math.sin(a),-e*Math.cos(a)]})},d3.createPlot=function(t,e){if(!e.standalone){var r=d3.select(t).select("svg");if(null!==r.node())return r}var a=e.width,n=e.height,r=d3.select(t).append("svg").attr("class",e.type).attr("width",a).attr("display","block"),i=0,o=e.title;if(o.show){var l=e.margin,s=r.append("text").attr("class","title").attr("x",o.x).attr("y",o.y).attr("stroke",o.stroke).attr("fill",o.fill).attr("font-size",o.fontSize).attr("font-weight",o.fontWeight).attr("text-anchor",o.textAnchor).text(o.text).call(d3.wrapText,o),c=Math.ceil(s.node().getComputedTextLength()/o.wrapWidth);i=c*o.lineHeight,l.top+=i}o.height=i;var d=d3.translate(a/2,n/2+i);r.attr("height",n+i).append("g").attr("class","container").attr("transform",d).attr("stroke",e.stroke).attr("stroke-width",e.strokeWidth);return r},d3.getPosition=function(t,e){for(var r=d3.select(t).node(),a=r.getBoundingClientRect(),n=e.tagName;r.parentElement.tagName!==n;)r=r.parentElement;var i=r.parentElement.getBoundingClientRect();return{top:a.top-i.top,left:a.left-i.left,width:a.width,height:a.height}},d3.setAxis=function(t,e){var r=d3.axisBottom(t),a=e.orient,n=e.ticks||{};return"top"===a?r=d3.axisTop(t):"left"===a?r=d3.axisLeft(t):"right"===a&&(r=d3.axisRight(t)),r.ticks(n.number).tickSizeInner(n.sizeInner).tickSizeOuter(n.sizeOuter).tickPadding(n.padding).tickValues(n.values).tickFormat(n.format),r},d3.setAxes=function(t,e){var r=t,a=e.width,n=e.height,i=e.axisX||{},o=e.axisY||{},l=i.orient||"bottom",s=o.orient||"left",c=i.domain,d=o.domain,u=d3.setAxis(e.scaleX,i),p=d3.setAxis(e.scaleY,o);if(e.framed){if(i.show){var h=r.select(".axis-bottom"),f=r.select(".axis-top");h.empty()&&(h=r.append("g").attr("class","axis axis-x axis-bottom")),f.empty()&&(f=r.append("g").attr("class","axis axis-x axis-top")),h.attr("transform",d3.translate(0,n)).call(u),f.call(u.tickFormat(""))}if(o.show){var m=r.select(".axis-left"),g=r.select(".axis-right");m.empty()&&(m=r.append("g").attr("class","axis axis-y axis-left")),g.empty()&&(g=r.append("g").attr("class","axis axis-y axis-right")),m.call(p),g.attr("transform",d3.translate(a,0)).call(p.tickFormat(""))}}else{if(i.show){var y=r.select(".axis-x");y.empty()&&(y=r.append("g").attr("class","axis axis-x")),"bottom"===l&&y.attr("transform",d3.translate(0,n)),y.call(u)}if(o.show){var v=r.select(".axis-y");v.empty()&&(v=r.append("g").attr("class","axis axis-y")),"right"===s&&v.attr("transform",d3.translate(a,0)),v.call(p)}}i.show&&(r.selectAll(".axis-x").attr("font-size",i.fontSize).selectAll("text").attr("text-anchor",i.textAnchor).attr("transform",i.transform).attr("rotate",i.rotate).attr("fill",i.fill),r.selectAll(".axis-x").selectAll("line").attr("stroke",i.stroke).attr("stroke-width",i.strokeWidth),r.selectAll(".axis-x").select(".domain").attr("stroke",c.stroke).attr("stroke-width",c.strokeWidth).attr("display",c.show?"block":"none")),o.show&&(r.selectAll(".axis-y").attr("font-size",o.fontSize).selectAll("text").attr("text-anchor",o.textAnchor).attr("transform",o.transform).attr("rotate",o.rotate).attr("fill",o.fill),r.selectAll(".axis-y").selectAll("line").attr("stroke",o.stroke).attr("stroke-width",o.strokeWidth),r.selectAll(".axis-y").select(".domain").attr("stroke",c.stroke).attr("stroke-width",d.strokeWidth).attr("display",d.show?"block":"none"));var x=e.gridX||{},k=e.gridY||{};if(x.show){var b=r.select(".grid-x");b.empty()&&(b=r.insert("g",":first-child").attr("class","grid grid-x")),b.attr("stroke-dasharray",x.strokeDash.join()).call(p.tickSize(-a,0).tickFormat("")),b.select(".domain").attr("stroke-width",0),b.selectAll(".tick").attr("stroke-width",function(){var t=d3.select(this).attr("transform"),e=+t.replace(/\,?\s+/,",").split(/[\,\(\)]/)[2];return Math.abs(e)<1||Math.abs(e-n)<1?0:null}).select("line").attr("stroke",x.stroke)}if(k.show){var w=r.select(".grid-y");w.empty()&&(w=r.insert("g",":first-child").attr("class","grid grid-y")),w.attr("stroke-dasharray",k.strokeDash.join()).attr("transform",d3.translate(0,n)).call(u.tickSize(-n,0).tickFormat("")),w.select(".domain").attr("stroke-width",0),w.selectAll(".tick").attr("stroke-width",function(){var t=d3.select(this).attr("transform"),e=+t.replace(/\,?\s+/,",").split(/[\,\(\)]/)[1];return Math.abs(e)<1||Math.abs(e-a)<1?0:null}).select("line").attr("stroke",k.stroke)}},d3.setLabels=function(t,e){var r=t,a=e.width,n=e.height,i=e.labelX,o=e.labelY,l=i.textAnchor,s=o.textAnchor;if(i.show){var c=r.select(".label-x"),d=0;"middle"===l?d=a/2:"end"===l&&(d=a),c.empty()&&(c=r.append("text").attr("class","label label-x")),c.attr("x",d).attr("y",n).attr("dy",i.dy).attr("transform",i.transform).attr("fill",i.fill).attr("text-anchor",l).text(i.text)}if(o.show){var u=r.select(".label-y"),p=n;"middle"===s?p=n/2:"end"===s&&(p=0),u.empty()&&(u=r.append("text").attr("class","label label-y")),u.attr("x",-p).attr("y",0).attr("dy",o.dy).attr("transform",o.transform).attr("fill",o.fill).attr("text-anchor",s).text(o.text)}},d3.setLegend=function(t,e){var r=e.show,a=e.data;if(r||null===r&&a.length>1){var n=e.type,i=e.display,o=e.maxWidth,l=e.columns,s=e.symbol,c=s.shape,d=Math.round(s.width),u=Math.round(s.height),p=e.textColor,h=e.disabledTextColor,f=e.lineHeight,m=t.select(".legend");m.empty()&&(m=t.append("g").attr("class","legend").attr("transform",e.translation).attr("cursor","pointer"));var g=m.selectAll(".legend-item").data(a,e.key);g.exit().remove(),g.enter().append("g").attr("class",function(t){return t.hasOwnProperty("disabled")||(t.disabled=t.data&&t.data.disabled||!1),"legend-item"+(t.disabled?" disabled":"")}).attr("transform",e.transform);var y=t.selectAll(".legend-item"),v=y.select(c);if(v.empty())if("circle"===c)y.append("circle").attr("cx",function(t,e){return"inline-block"===i?o*(e%l)+d/2:d/2}).attr("cy",function(t,e){return"inline-block"===i&&(e=Math.floor(e/l)),f*(e+1)-u/2}).attr("r",Math.min(d,u)/2);else if("rect"===c)y.append("rect").attr("width",d).attr("height",u).attr("x",function(t,e){return"inline-block"===i?o*(e%l):0}).attr("y",function(t,e){return"inline-block"===i&&(e=Math.floor(e/l)),f*(e+1)-u}).attr("rx",e.rx).attr("ry",e.ry);else if("icon"===c){var x=d3.icon().size([d,u]);y.selectAll(".icon").data(function(t,e){var r=0,a=0;return"inline-block"===i&&(r=o*(e%l),e=Math.floor(e/l)),a=f*(e+1)-u,x.x(r).y(a).color(t.color)([t.icon||t.data.icon])}).enter().append("g").attr("class","icon").attr("transform",function(t){return t.transform}).selectAll("path").data(function(t){return t.shapes}).enter().append("path").attr("d",function(t){return t.path}).attr("fill",function(t){return t.color})}y.select(c).attr("fill",function(t){return t.disabled?h:t.color});var k=e.dx,b=o-d-2*k,w=y.select("text");w.empty()&&y.append("text").attr("x",function(t,e){return"inline-block"===i?o*(e%l)+d:d}).attr("y",function(t,e){return"inline-block"===i&&(e=Math.floor(e/l)),f*(e+1)}).attr("dx",k).attr("lengthAdjust","spacingAndGlyphs"),y.select("text").text(e.text).attr("fill",function(t){return t.disabled?h:p}).attr("textLength",function(t){var e=d3.select(this).node().getComputedTextLength();return e>b?b:null}),y.on("click",function(t){var r=t.disabled;"checkbox"===n?t.disabled=!r:"radio"===n&&(t.disabled=!1);var a=d3.select(this).classed("disabled",t.disabled),i="icon"===c?"path":c;a.selectAll(i).attr("fill",t.disabled?h:t.color),a.selectAll("text").attr("fill",t.disabled?h:p),e.onclick(t)}),e.autoplay&&y.call(d3.triggerAction,d3.extend({event:"click",carousel:!0},e.carousel))}},d3.setTooltip=function(t,e){if(e.show){var r=d3.select("#"+e.id),a=parseInt(r.style("line-height")),n=e.target,i=e.effect;n.on("mouseover",function(n,o){var l=d3.mouse(t),s=l[0],c=l[1];if(r.attr("class","tooltip").style("display","block").html(e.html(n,o)),isNaN(s)||isNaN(c)){var d=parseInt(r.style("width"))/2,u=parseInt(r.style("height"))+a/6;l=d3.getPosition(this,t),s=l.left+l.width/2-d,c=l.top+l.height/2-u}r.style("left",s+"px").style("top",c+"px"),"darker"===i&&d3.select(this).attr("fill",d3.color(n.color).darker())}).on("mousemove",function(e){var n=d3.mouse(t),i=parseInt(r.style("width"))/2,o=parseInt(r.style("height"))+a/6;r.style("left",n[0]-i+"px").style("top",n[1]-o+"px")}).on("mouseout",function(t){r.style("display","none"),"darker"===i&&d3.select(this).attr("fill",t.color)}),e.autoplay&&n.call(d3.triggerAction,d3.extend({event:"mouseover",carousel:!0},e.carousel))}},d3.setArrows=function(t,e){var r=e.arrow;if(r.show){var a=d3.select(t).select("svg"),n=a.select("defs");n.empty()&&(n=a.insert("defs",":first-child"));var i=r.size,o=i/2,l=r.strokeWidth,s=t.id+"-arrow",c=n.select(".arrow");c.empty()&&(c=n.append("marker").attr("class","arrow").attr("markerUnits","strokeWidth").attr("orient","auto")),c.attr("id",s).attr("markerWidth",i).attr("markerHeight",i).attr("viewBox","0 0 "+i+" "+i).attr("refX",o).attr("refY",o);var d=c.select("path");d.empty()&&(d=c.append("path")),d.attr("stroke",r.stroke).attr("strokeWidth",l).attr("fill",r.fill).attr("d",function(){var t=d3.path(),e=2*l,r=i-e;return t.moveTo(e,e),t.lineTo(r,o),t.lineTo(e,r),t.lineTo(o,o),t.lineTo(e,e),t.toString()}),e.path.attr("marker-end","url(#"+s+")")}},d3.wrapText=function(t,e){if(e.wrapText){var r=e.wrapWidth,a=e.lineHeight;t.each(function(){var t=d3.select(this),n=t.text().split(/\s+/).reverse();if(n.length>1){for(var i=t.attr("x"),o=t.attr("y"),l=(parseFloat(t.attr("dy")),t.text(null).append("tspan")),s=n.pop(),c=0,d=[];s;)d.push(s),l.text(d.join(" ")),l.node().getComputedTextLength()>r&&(d.pop(),l.text(d.join(" ")),d=[s],c+=1,l=t.append("tspan").attr("x",i).attr("dy",a).text(s)),s=n.pop();if(e.verticalAlign){var u=e.verticalAlign,p=0;"middle"===u?p=.5:"bottom"===u&&(p=1),t.attr("y",o-c*a*p)}}})}},d3.triggerAction=function(t,e){var r=e.event||e,a=e&&e.filter||null,n=e&&e.sort||null,i=null!==a?t.filter(a):t,o=i.sort(n).nodes();if("object"===d3.type(e)){var l=e.delay||0,s=o.length;if(s&&e.carousel)var c=e.interval||2e3,d=e.limit||s,u=e.randomize,p=e.infinite,h=0,f=0,m=d3.timer(function(t){t>c*f&&(f+=1,d3.select(o[h]).dispatch(r),h=u===!0?Math.floor(Math.random()*s):(h+1)%s),p===!1&&f>=d&&m.stop()},l);else d3.timeout(function(){d3.selectAll(o).dispatch(r)},l)}else d3.selectAll(o).dispatch(r)},d3.setTiles=function(t,e){var r=e.image,a=r.size,n=r.href;if("object"===d3.type(n)){var i=d3.mapTiles[n.service]||{},o=i.themes||[];if(Array.isArray(o)){var l=n.token||i.token,s=n.theme||o[0],c=n.subdomain,d=i.subdomains||[],u=d.length,p=i.url;n=function(t){var e=c;return u&&void 0===c&&(e=d[Math.random()*u|0]),d3.formatString(p,{k:l,s:e,t:s,x:t.x,y:t.y,z:t.z})}}}var h=d3.tile().size(e.size).scale(e.scale).translate(e.translate).wrap(e.wrap)(),f=t.selectAll("image").data(h,function(t){return[t.tx,t.ty,t.z]});f.exit().remove(),f.enter().append("image").attr("xlink:href",n).attr("x",function(t){return t.tx}).attr("y",function(t){return t.ty}).attr("width",a+1).attr("height",a+1),t.attr("transform",function(){var t=h.scale,e=h.translate,r=t/a,n=t%1?Number:Math.round,i=n(e[0]*t),o=n(e[1]*t);return"translate("+i+","+o+") scale("+r+")"}).style("filter",e.filter)},d3.parseGeoData=function(t,e){var r=t.data,a=t.key||"id",n=e&&e.data||[],i=[],o=[],l=d3.type(r);if("object"===l)if(r.hasOwnProperty("features"))i=r.features;else if("object"==typeof topojson&&t.object){var s=r.objects[t.object];i=topojson.feature(r,s).features,e.neighbors&&(o=topojson.neighbors(s.geometries))}return e.mixin?(n.forEach(function(t){var e=t[a],r=i.some(function(r){var n=String(r[a]||r.properties[a]);return e===n&&(t.coordinates=r.geometry.coordinates,!0)});r||i.some(function(r){var n=String(r[a]||r.properties[a]);return!(!/^\W/.test(e)||!new RegExp(e).test(n))&&(t.coordinates=r.geometry.coordinates,!0)})}),n):{features:i.map(function(t,e){var r=String(t[a]||t.properties[a]||e);t.data={id:r,value:void 0};var i=n.some(function(e){return(e[a]||e.id)===r&&(t.data=e,!0)});return i||n.some(function(e){var n=String(e[a]);return!(!/^\W/.test(n)||!new RegExp(n).test(r))&&(t.data=e,!0)}),t}),neighbors:o}},d3.mapData={world:{center:[0,0],scale:1},china:{key:"name",center:[103.3886,35.5636],scale:1}},d3.mapTiles={amap:{url:"https://webrd03.is.autonavi.com/appmaptile?size=1&scale=1&style=8&x=${x}&y=${y}&z=${z}"},geoq:{url:"https://map.geoq.cn/ArcGIS/rest/services/${t}/MapServer/tile/${z}/${y}/${x}",themes:["ChinaOnlineCommunity_Mobile","ChinaOnlineCommunityENG","ChinaOnlineCommunity","ChinaOnlineStreetGray","ChinaOnlineStreetPurplishBlue"]},google:{url:"https://google.cn/maps/vt?x=${x}&y=${y}&z=${z}"},mediawiki:{url:"https://maps.wikimedia.org/${t}/${z}/${x}/${y}.png",themes:["osm","osm-intl"]},openstreetmap:{url:"https://${s}.tile.openstreetmap.org/${z}/${x}/${y}.png",subdomains:["a","b","c"]},stamen:{url:"https://stamen-tiles-${s}.a.ssl.fastly.net/${t}/${z}/${x}/${y}.jpg",subdomains:["a","b","c","d"],themes:["terrain","terrain-labels","terrain-lines","terrain-background","watercolor"]},geohey:{url:"https://${s}.geohey.com/s/mapping/${t}/all?z=${z}&x=${x}&y=${y}&ak=${k}",subdomains:["s1","s2","s3","s4","s5","s6","s7","s8"],themes:["warm","cool","midnight","pencil","dark","contrast","pink","vision","adventure","blue","light","fresh","natural","admin","tourism","river","chinese"],token:"MGUxMmI2ZTk4YTVhNDEzYmJhZDJkNDM3ZWI5ZDAwOGE"},mapbox:{url:"https://${s}.tiles.mapbox.com/v4/mapbox.${t}/${z}/${x}/${y}.png?access_token=${k}",subdomains:["a","b","c","d"],themes:["natural-earth-2","streets","light","dark","satellite","streets-satellite","wheatpaste","streets-basic","comic","outdoors","run-bike-hike","pencil","pirates","emerald","high-contrast"],token:"pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NDg1bDA1cjYzM280NHJ5NzlvNDMifQ.d6e-nNyBDtmQCVwVNivz7A"},thunderforest:{url:"https://${s}.tile.thunderforest.com/${t}/${z}/${x}/${y}.png?apikey=${k}",subdomains:["a","b","c"],themes:["cycle","transport","landscape","outdoors","transport-dark","spinal-map"],token:"7c352c8ff1244dd8b732e349e0b0fe8d"}},d3.icon=function(){function t(t){return[].concat(t).map(function(t,i){if("string"===d3.type(t)){var o=d3.icons[t];t="string"===d3.type(o)?d3.icons[o]:o}"array"===d3.type(t)&&t.length>=3&&(t={width:t[0],height:t[1],path:t[2],color:t[3]});var l="function"===d3.type(e)?e(t,i):e,s="function"===d3.type(r)?r(t,i):r,c=l-(t.x||0),d=s-(t.y||0),u="function"===d3.type(a)?a(t,i):a,p=u[0]/(t.width||1),h=u[1]/(t.height||1),f=[].concat(t.path),m=f.length,g=t.color,y=d3.type(g),v="function"===d3.type(n)?[].concat(n(t,i)):n;return 0===v.length&&("array"===y?v=g:"string"===y&&(v=Array.apply(null,Array(m)).map(function(){return g}))),1===v.length&&m>1&&(g=v.pop(),v=Array.apply(null,Array(m)).map(function(){return g})),{data:t,shapes:f.map(function(t,e){return{path:t,color:v[e]}}),transform:d3.formatString("translate(${x},${y}) scale(${k})",{x:c,y:d,k:Math.max(p,h)})}})}var e=0,r=0,a=[32,32],n=[];return t.x=function(r){var a=d3.type(r);return"undefined"===a?e:("function"!==a&&"number"!==a||(e=r),t)},t.y=function(e){var a=d3.type(e);return"undefined"===a?r:("function"!==a&&"number"!==a||(r=e),t)},t.size=function(e){var r=d3.type(e);return"undefined"===r?a:("function"===r||"array"===r?a=e:"number"===r&&(a=[e,e]),t)},t.color=function(e){var r=d3.type(e);return"undefined"===r?n:("function"===r||"array"===r?n=e:"string"===r&&(n=[e]),t)},t},d3.icons=d3.extend({},"object"==typeof schema?schema.icons:{}),d3.components.barChart={type:"bar chart",schema:{type:"object",entries:[{key:"category",type:"string",aliases:["label","name"]},{key:"value",type:"number",aliases:["count","frequency","percentage","ratio"]},{key:"series",type:"string",aliases:["group","type"],optional:!0}]},sort:null,stacked:!1,horizontal:!1,paddingInner:.4,paddingOuter:.4,paddingMidst:0,align:.5,framed:!1,refline:{show:!1,stroke:"#d62728",strokeWidth:1,strokeDash:[6,4],threshold:1/0},legend:{show:null,text:function(t){return t.series}},tooltip:{html:function(t){return t.category+": "+t.value}},margin:{top:"4em",right:"2em",bottom:"2em",left:"4em"}},d3.barChart=function(t,e){t=d3.parseData("barChart",t),e=d3.parseOptions("barChart",e);var r=d3.dispatch("init","update","finalize"),a=e.chart,n=e.renderer,i=(e.context,e.width,e.height,e.innerWidth),o=e.innerHeight,l=e.margin,s=(e.stroke,e.strokeWidth),c=e.colorScheme,d=(e.fontSize,e.lineHeight,e.categories||[]),u=e.series||[],p=[],h=null,f=null,m=0;e.horizontal?(h=d3.scaleLinear().rangeRound([0,i]),f=d3.scaleBand().paddingInner(e.paddingInner).paddingOuter(e.paddingOuter).rangeRound([o,0]).align(e.align)):(h=d3.scaleBand().paddingInner(e.paddingInner).paddingOuter(e.paddingOuter).rangeRound([0,i]).align(e.align),f=d3.scaleLinear().rangeRound([o,0]));var g=d3.scaleOrdinal().domain(u).range(c),y=function(t){return g(t.series)};if("svg"===n){var v=d3.createPlot(a,e),x=v.select(".container").attr("transform",d3.translate(l.left,l.top));r.on("init.data",function(t){var e=d3.set(t,function(t){return t.category}),r=d3.set(t,function(t){return t.series});e.size()!==d.length&&(d=e.values()),r.size()!==u.length&&(u=r.values()),p.length||(p=u.map(function(t){return{series:t,disabled:!1,color:g(t)}})),t.sort(function(t,e){var r=d.indexOf(t.category),a=d.indexOf(e.category);if(r!==a)return d3.ascending(r,a);var n=u.indexOf(t.series),i=u.indexOf(e.series);return d3.ascending(n,i)})}),r.on("init.layout",function(t){var r=e.stacked,a=e.horizontal;m=r?d3.max(d,function(e){return d3.sum(t,function(t){return t.category===e?t.value:0})}):d3.max(t,function(t){return t.value}),a?(h.domain([0,m]),f.domain(d)):(h.domain(d),f.domain([0,m]));var n=x.select(".layout");n.empty()&&(n=x.append("g").attr("class","layout"));var i=n.selectAll(".slice").data(t);i.exit().remove(),i.enter().append("rect").attr("class","slice");var l=n.selectAll(".slice");if(a){var c=f.bandwidth();if(r)l.attr("y",function(t){return f(t.category)}).attr("x",function(e,r){var a=e.category,n=d3.sum(t.slice(0,r),function(t){return t.category===a?t.value:0});return h(n)});else{var p=u.length,v=c/p,k=f.step()*e.paddingMidst,b=v+k+1,w=k*(p-1)/2-1;c=v,l.attr("x",0).attr("y",function(e,r){var a=e.category,n=t.slice(0,r).reduce(function(t,e){return t+(e.category===a?1:0)},0);return f(a)+(e.series!==u[0]?b:1)*n-w})}l.attr("width",function(t){return h(t.value)}).attr("height",c)}else{var c=h.bandwidth();if(r)l.attr("x",function(t){return h(t.category)}).attr("y",function(e,r){var a=e.category,n=d3.sum(t.slice(0,r+1),function(t){return t.category===a?t.value:0});return f(n)});else{var p=u.length,A=c/p,z=h.step()*e.paddingMidst,S=A+z+1,M=z*(p-1)/2-1;c=A,l.attr("x",function(e,r){var a=e.category,n=t.slice(0,r).reduce(function(t,e){return t+(e.category===a?1:0)},0);return h(a)+(e.series!==u[0]?S:1)*n-M}).attr("y",function(t){return f(t.value)})}l.attr("width",c).attr("height",function(t){return o-f(t.value)})}l.attr("stroke",function(t){return t.color=g(t.series),d3.color(t.color).darker()}).attr("stroke-width",s).attr("fill",y)}),r.on("init.refline",function(t){var r=e.refline,a=r.threshold;if(r.show&&m>a){var n=x.select(".refline");if(n.empty()&&(n=x.select(".layout").append("line").attr("class","refline")),n.attr("stroke",r.stroke).attr("stroke-width",r.strokeWidth).attr("stroke-dasharray",r.strokeDash.join()),e.horizontal){var l=h(a);n.attr("x1",l).attr("y1",0).attr("x2",l).attr("y2",o)}else{var s=f(a);n.attr("x1",0).attr("y1",s).attr("x2",i).attr("y2",s)}}}),r.on("init.axes",function(t){var r=e.axisX,a=e.axisY;e.horizontal?void 0===r.ticks.format&&(r.ticks.format=d3.format("d")):void 0===a.ticks.format&&(a.ticks.format=d3.format("d")),d3.setAxes(x,{width:i,height:o,scaleX:h,scaleY:f,axisX:r,axisY:a,gridX:e.gridX,gridY:e.gridY,framed:e.framed})}),r.on("init.labels",function(t){d3.setLabels(x,{width:i,height:o,labelX:e.labelX,labelY:e.labelY})}),r.on("update.tooltip",function(t){var r=e.tooltip;r.target=t.selectAll("rect"),r.effect="darker",d3.setTooltip(a,r)}),r.on("finalize.legend",function(){var a=e.legend;a.translation||(a.translation=d3.translate(-l.left,-l.top)),a.data=p,a.onclick=function(e){var a=e.series,n=e.disabled;t.forEach(function(t){t.series===a&&(t.disabled=n)}),r.call("init",this,t.filter(function(t){return!t.disabled})),r.call("update",this,x.select(".layout"))},d3.setLegend(x,a)}),r.call("init",this,t),r.call("update",this,x.select(".layout")),r.call("finalize",this)}},d3.components.pieChart={type:"pie chart",schema:{type:"object",entries:[{key:"label",type:"string",aliases:["category","name"]},{key:"value",type:"number",aliases:["count","percentage","ratio"]}]},sort:null,arcs:{maxRatio:.8,donutRatio:0,innerRadius:0},labels:{show:!1,dy:"0.25em",stroke:"none",fill:"#fff",centroidRatio:1,minAngle:Math.PI/10,wrapText:!1,wrapWidth:"5em",lineHeight:"1.2em",verticalAlign:"middle",text:function(t){var e=(t.endAngle-t.startAngle)/(2*Math.PI);return d3.format(".0%")(e)}},legend:{show:!0,text:function(t){return t.data.label}},tooltip:{html:function(t){var e=(t.endAngle-t.startAngle)/(2*Math.PI);return t.data.label+": "+d3.format(".1%")(e)}}},d3.pieChart=function(t,e){t=d3.parseData("pieChart",t),e=d3.parseOptions("pieChart",e);var r=d3.dispatch("init","update","finalize"),a=e.chart,n=e.renderer,i=e.context,o=e.width,l=e.height,s=e.innerWidth,c=e.innerHeight,d=(e.stroke,e.strokeWidth,e.colorScheme),u=(e.fontSize,e.lineHeight,e.arcs),p=u.maxRatio,h=u.donutRatio,f=u.outerRadius||Math.min(s,c)/2,m=u.innerRadius||f*h;"number"===d3.type(m)&&"number"===d3.type(f)&&(m=Math.min(m,f*p));var g=d3.pie().sort(e.sort).value(function(t){return t.disabled?0:t.value}),y=d3.arc().innerRadius(m).outerRadius(f).context(i),v=g(t);if("svg"===n){var x=d3.createPlot(a,e),k=x.select(".container");r.on("init.slices",function(t){var e=k.selectAll(".arc").data(t,function(t){return t.label});e.exit().remove(),e.enter().append("g").attr("class","arc").attr("stroke",u.stroke)}),r.on("update.arcs",function(t){var e=d3.scaleOrdinal(d),r=t.select("path");r.empty&&(r=t.append("path")),r.attr("d",y).attr("fill",function(t){return t.label=t.data.label,t.color=e(t.label),t.color})}),r.on("update.labels",function(t){var r=e.labels;if(r.show){var a=r.centroidRatio,n=t.select("text");n.empty&&(n=t.append("text").attr("class","label")),n.attr("x",function(t){return y.centroid(t)[0]*a}).attr("y",function(t){return y.centroid(t)[1]*a}).attr("dy",r.dy).attr("fill",r.fill).attr("stroke",r.stroke).attr("text-anchor","middle").text(r.text).style("display",function(t){var e=t.endAngle-t.startAngle;return e<r.minAngle?"none":"block"}).call(d3.wrapText,r)}}),r.on("update.tooltip",function(t){var r=e.tooltip;r.target=t.selectAll("path"),r.effect="darker",d3.setTooltip(a,r)}),r.on("finalize.legend",function(){var a=e.legend;a.translation||(a.translation=d3.translate(-o/2,-l/2)),a.data=v,a.onclick=function(e){var a=e.label,n=e.data.disabled;t.some(function(t){return t.label===a&&(t.disabled=!n,!0)}),v=g(t),r.call("init",this,v),r.call("update",this,k.selectAll(".arc"))},d3.setLegend(k,a)}),r.call("init",this,v),r.call("update",this,k.selectAll(".arc")),r.call("finalize",this)}},d3.components.lineChart={type:"line chart",schema:{type:"object",entries:[{key:"x",type:"number",aliases:["year","name"]},{key:"y",type:"number",aliases:["count","percentage","ratio","value"]}]},sort:null,lines:{curve:"curveLinear",density:1,stroke:"#1f77b4",strokeWidth:1,fill:"none"},dots:{show:!1,radius:"0.5%",stroke:"#1f77b4",strokeWidth:1,fill:"#fff"},tooltip:{html:function(t){var e=d3.format(".3"),r=Number(t.x.toFixed(3)),a=Number(t.y.toFixed(3));return"x: "+e(r)+", y: "+e(a)}}},d3.lineChart=function(t,e){t=d3.parseData("lineChart",t),e=d3.parseOptions("lineChart",e);var r=(d3.dispatch("init","update","finalize"),e.chart),a=e.renderer,n=(e.context,e.width,e.height,e.innerWidth),i=e.innerHeight,o=e.margin,l=(e.stroke,e.strokeWidth,e.colorScheme,e.fontSize,e.lineHeight,e.lines),s=Math.round(n*l.density),c=e.domainX,d=e.domainY,u=d3.type(t),p=[];if("function"===u){var h=c[0],f=c[1],m=(f-h)/s;d3.range(h,f+m/2,m).forEach(function(e){var r=t(e);p.push({x:e,y:r})})}else"array"===u&&(t.sort(function(t,e){return d3.ascending(t.x,e.x)}),p=t);void 0===c&&(c=d3.extent(p,function(t){return t.x})),void 0===d&&(d=d3.extent(p,function(t){return t.y}));var g=d3.scaleLinear().domain(c).rangeRound([0,n]).nice(),y=d3.scaleLinear().domain(d).rangeRound([i,0]).nice(),v=d3.line().x(function(t){return g(t.x)}).y(function(t){return y(t.y)}).curve(d3[l.curve]);if("svg"===a){var x=d3.createPlot(r,e),k=x.select(".container").attr("transform",d3.translate(o.left,o.top));d3.setAxes(k,{width:n,height:i,scaleX:g,scaleY:y,axisX:e.axisX,axisY:e.axisY,gridX:e.gridX,gridY:e.gridY,framed:e.framed}),d3.setLabels(k,{width:n,height:i,labelX:e.labelX,labelY:e.labelY}),k.append("g").attr("class","lines").append("path").datum(p).attr("d",v).attr("stroke",l.stroke).attr("stroke-width",l.strokeWidth).attr("fill",l.fill)}var b=e.dots;b.show&&k.append("g").attr("class","dots").selectAll(".dot").data(p).enter().append("circle").attr("class","dot").attr("cx",function(t){return g(t.x)}).attr("cy",function(t){return y(t.y)}).attr("r",b.radius).attr("stroke",b.stroke).attr("stroke-width",b.strokeWidth).attr("fill",b.fill);var w=e.tooltip;w.target=k.selectAll(".dot"),d3.setTooltip(r,w)},d3.components.bubbleChart={type:"bubble chart",schema:{type:"object",entries:[{key:"x",type:"number",aliases:["category","name","year"]},{key:"y",type:"number",aliases:["count"]},{key:"z",type:"number",aliases:[]}]},offsetX:[.5,.5],offsetY:[0,0],framed:!1,axisX:{ticks:{format:d3.format("d")
}},axisY:{ticks:{format:d3.format("d")}},gridX:{show:!0},dots:{scale:"2%",minRadius:4,maxRadius:1/0,normalize:"sqrt",stroke:"#fff",opacity:.8,gradient:!1,hue:160,saturation:.8,lightness:.6},tooltip:{html:function(t){return"x = "+t.x+"<br/>y = "+t.y+"<br/>z = "+t.z}}},d3.bubbleChart=function(t,e){t=d3.parseData("bubbleChart",t),e=d3.parseOptions("bubbleChart",e);var r=(d3.dispatch("init","update","finalize"),e.chart),a=e.renderer,n=(e.context,e.width,e.height,e.innerWidth),i=e.innerHeight,o=e.margin,l=(e.stroke,e.strokeWidth,e.colorScheme),s=(e.fontSize,e.lineHeight,e.offsetX),c=e.offsetY,d=d3.extent(t,function(t){return t.x}),u=d3.extent(t,function(t){return t.y}),p=d3.extent(t,function(t){return t.z}),h=d[0],f=d[1],m=u[0],g=u[1],y=p[0],v=p[1],x=d3.scaleLinear().domain(e.domainX||[h-s[0],f+s[1]]).rangeRound(e.rangeX||[0,n]),k=d3.scaleLinear().domain(e.domainY||[m-c[0],g+c[1]]).rangeRound(e.rangeY||[i,0]).nice();if("svg"===a){var b=d3.createPlot(r,e),w=b.select(".container").attr("transform",d3.translate(o.left,o.top));d3.setAxes(w,{width:n,height:i,scaleX:x,scaleY:k,axisX:e.axisX,axisY:e.axisY,gridX:e.gridX,gridY:e.gridY,framed:e.framed}),d3.setLabels(w,{width:n,height:i,labelX:e.labelX,labelY:e.labelY});var A=d3.scaleOrdinal(l),z=e.dots,S=z.scale,M=z.minRadius,W=z.maxRadius,O=z.normalize,C=z.opacity,P=z.hue,j=z.saturation,Y=z.lightness,$=w.selectAll(".dot").data(t).enter().append("circle").attr("class","dot").attr("cx",function(t){return x(t.x)}).attr("cy",function(t){return k(t.y)}).attr("r",function(t){var e=0;return W!==1/0&&W?W>M&&(e=(t.z-y)/(v-y),S=W-M):e=t.z/v,"sqrt"===O&&(e=Math.sqrt(e)),Math.round(e*S+M)}).attr("opacity",C).attr("stroke",z.stroke).attr("fill",function(t){if("function"==typeof z.color)return z.color(t);if(z.gradient){var e=P*(1-t.y/g)+(180-P),r=j*(t.y-m)/(g-m||1)+(1-j),a=Y-(1-Y)*(t.x-h)/(f-h||1);return d3.hsl(e,r,a)}return A(t.x)}).sort(function(t,e){return e.z-t.z});z.onclick&&$.attr("cursor","pointer").on("click",function(t){"function"==typeof z.onclick&&z.onclick(t)});var D=e.tooltip;D.target=w.selectAll(".dot"),d3.setTooltip(r,D)}},d3.components.radarChart={type:"radar chart",schema:{type:"object",entries:[{key:"axis",type:"string",aliases:["category","label","name"]},{key:"value",type:"number",aliases:["count","percentage","ratio"]},{key:"series",type:"string",aliases:["group","type"],optional:!0}]},sort:null,curve:"curveLinearClosed",levels:3,maxValue:0,grids:{show:!0,shape:"polygon",stroke:"#ccc",strokeWidth:1,fill:"none"},rays:{show:!0,stroke:"#999",strokeWidth:1},areas:{stroke:"#1f77b4",strokeWidth:2,fill:"#3182bd",opacity:.65},dots:{show:!0,radius:"0.5%",strokeWidth:1,fill:"#fff"},labels:{show:!0,dy:"0.25em",padding:"1em",wrapText:!1,wrapWidth:"10em",lineHeight:"1.2em",verticalAlign:"middle",fill:"currentColor"},legend:{show:null,text:function(t){return t.series}},tooltip:{html:function(t){return t.axis+": "+t.value}}},d3.radarChart=function(t,e){t=d3.parseData("radarChart",t),e=d3.parseOptions("radarChart",e);var r=(d3.dispatch("init","update","finalize"),e.chart),a=e.renderer,n=e.context,i=e.width,o=e.height,l=e.innerWidth,s=e.innerHeight,c=(e.stroke,e.strokeWidth,e.colorScheme),d=(e.fontSize,e.lineHeight,e.axes||[]),u=e.series||[],p=[],h=[];t.forEach(function(t){var e=t.axis,r=t.series;d.indexOf(e)===-1&&d.push(e),u.indexOf(r)===-1&&u.push(r),h.push(t.value)}),p=u.map(function(e){var r=t.filter(function(t){return t.series===e});return{series:e,disabled:!1,data:d.map(function(t){var e=null;return r.some(function(r){return r.axis===t&&(e=r,!0)}),null===e&&(e={axis:t,value:0}),e})}});var f=d.length,m=2*Math.PI/f,g=Math.min(l,s)/2,y=Math.max(d3.max(h),e.maxValue),v=d3.scaleLinear().range([0,g]).domain([0,y]),x=d3.radialLine().radius(function(t){return v(t.value)}).angle(function(t,e){return m*e}).curve(d3[e.curve]).context(n);if("svg"===a){var k=d3.createPlot(r,e),b=k.select(".container"),w=e.grids,A=e.levels;if(w.show){var z=w.shape;"polygon"===z?b.selectAll(".grid").data(d3.range(1,A+1)).enter().append("polygon").attr("class","grid").attr("points",function(t){var e=v(y/A*t);return d3.regularPolygon(f,e).join(" ")}).attr("stroke",w.stroke).attr("stroke-width",w.strokeWidth).attr("fill",w.fill):"circle"===z&&b.selectAll(".grid").data(d3.range(1,A+1)).enter().append("circle").attr("class","grid").attr("cx",0).attr("cy",0).attr("r",function(t){return g/A*t}).attr("stroke",w.stroke).attr("stroke-width",w.strokeWidth).attr("fill",w.fill)}var S=e.rays;S.show&&b.selectAll(".ray").data(d3.range(f)).enter().append("line").attr("class","ray").attr("x1",0).attr("y1",0).attr("x2",function(t){return g*Math.sin(m*t)}).attr("y2",function(t){return-g*Math.cos(m*t)}).attr("stroke",S.stroke).attr("stroke-width",S.strokeWidth);var M=d3.scaleOrdinal(c),W=function(t){return t.color},O=function(t){return d3.color(t.color).darker()},C=e.areas,P=e.dots,j=b.selectAll(".series").data(p).enter().append("g").attr("class","series").attr("stroke",function(t){return t.color=M(t.series),d3.color(t.color).darker()}).attr("stroke-width",C.strokeWidth).style("display",function(t){return t.disabled?"none":"block"});j.append("path").attr("class","area").attr("d",function(t){return x(t.data)}).attr("fill",W).attr("opacity",C.opacity).on("mouseover",function(){j.selectAll(".area").attr("fill","none").attr("pointer-events","none"),d3.select(this).attr("fill",O).attr("pointer-events","visible")}).on("mouseout",function(){j.selectAll(".area").attr("fill",W).attr("pointer-events","visible")});P.show&&j.selectAll(".dot").data(function(t){return t.data}).enter().append("circle").attr("class","dot").attr("cx",function(t,e){return v(t.value)*Math.sin(m*e)}).attr("cy",function(t,e){return-v(t.value)*Math.cos(m*e)}).attr("r",P.radius).attr("stroke",P.stroke).attr("stroke-width",P.strokeWidth).attr("fill",P.fill);var Y=e.labels;if(Y.show){var $=g+Y.padding;b.selectAll(".label").data(d).enter().append("text").attr("class","label").attr("x",function(t,e){return $*Math.sin(m*e)}).attr("y",function(t,e){return-$*Math.cos(m*e)}).attr("dy",Y.dy).attr("text-anchor",function(t,e){var r="middle";return e>0&&e<Math.ceil(f/2)?r="start":e>=Math.floor(f/2)+1&&(r="end"),r}).attr("fill",Y.fill).text(function(t){return t}).call(d3.wrapText,Y)}var D=e.legend;D.translation||(D.translation=d3.translate(-i/2,-o/2)),D.data=p,D.onclick=function(){j.style("display",function(t){return t.disabled?"none":"block"})},d3.setLegend(b,D);var I=e.tooltip;I.target=j.selectAll(".dot"),d3.setTooltip(r,I)}},d3.components.sunburstChart={type:"sunburst chart",schema:{type:"object",hierarchy:"children",entries:[{key:"label",type:"string",aliases:["category","name"]},{key:"value",type:"number",aliases:["count","percentage","ratio"]},{key:"children",type:"array"}]},sort:null,donut:{show:!1,ratio:.2,radius:20},zoomable:!0,labels:{show:!1},tooltip:{html:function(t){return t.data.label+": "+t.data.value}},stroke:"#fff",colorScheme:d3.schemeCategory20c},d3.sunburstChart=function(t,e){t=d3.parseData("sunburstChart",t),e=d3.parseOptions("sunburstChart",e);var r=(d3.dispatch("init","update","finalize"),e.chart),a=e.renderer,n=e.context,i=e.width,o=e.height,l=(e.stroke,e.strokeWidth,e.colorScheme),s=(e.fontSize,e.lineHeight,Math.min(i,o)/2),c=d3.scaleLinear().range([0,2*Math.PI]),d=d3.scaleSqrt().range([0,s]),u=d3.hierarchy(t,function(t){return t.children}).sum(function(t){return t.children?0:t.value});"function"==typeof e.sort&&u.sort(e.sort),d3.partition()(u);var p=d3.arc().startAngle(function(t){return Math.max(0,Math.min(2*Math.PI,c(t.x0)))}).endAngle(function(t){return Math.max(0,Math.min(2*Math.PI,c(t.x1)))}).innerRadius(function(t){return Math.max(0,d(t.y0))}).outerRadius(function(t){return Math.max(0,d(t.y1))}).context(n);if("svg"===a){var h=d3.createPlot(r,e),f=h.select(".container"),m=d3.scaleOrdinal(l),g=e.donut,y=f.selectAll(".arc").data(u.descendants()).enter().append("g").attr("class","arc").append("path").attr("d",p).attr("opacity",function(t){return g.show&&null===t.parent?0:null}).attr("fill",function(t){return m((t.children?t:t.parent).data.label)});e.zoomable&&y.attr("cursor","pointer").on("click",function(t){var e=s*g.ratio||g.radius;f.transition().tween("scale",function(){var r=d3.interpolate(c.domain(),[t.x0,t.x1]),a=d3.interpolate(d.domain(),[t.y0,1]),n=d3.interpolate(d.range(),[t.y0?e:0,s]);return function(t){c.domain(r(t)),d.domain(a(t)).range(n(t))}}).selectAll("path").attrTween("d",function(t){return function(){return p(t)}})});var v=e.tooltip;v.target=f.selectAll(".arc"),d3.setTooltip(r,v)}},d3.components.choroplethMap={type:"choropleth map",schema:{type:"object",entries:[{key:"id",type:"string",aliases:["adcode","city","code","county","country","district","name","nation","province","state"]},{key:"value",type:"number",aliases:["count","percentage","ratio"]},{key:"series",type:"string",aliases:["group","type"],optional:!0}]},levels:5,projection:"geoMercator",coloring:"ordinal",colorScale:"scaleOrdinal",zoomable:!1,scaleExtent:[1,24],graticules:{show:!1,step:[10,10],precision:1,stroke:"#ccc"},regions:{show:!0,stroke:"#666",fill:"#fff"},tile:{show:!1,zoomable:!0,scale:512,scaleExtent:[512,16777216],image:{size:256}},labels:{show:!1,dy:"0.25em",stroke:"none",fill:"#333",fontSize:"0.5em",opacity:1,text:function(t){return t.data.id}},tooltip:{html:function(t){return t.data.id+": "+t.data.value}},colorScheme:d3.schemeCategory20c},d3.choroplethMap=function(t,e){t=d3.parseData("choroplethMap",t),e=d3.parseOptions("choroplethMap",e);var r=(d3.dispatch("init","update","finalize"),e.chart),a=(e.id,e.renderer),n=(e.context,e.width),i=e.height,o=(e.stroke,e.fill),l=(e.strokeWidth,e.fontSize,e.lineHeight,e.domain||[]),s=d3.extent(t,function(t){return t.value}),c=l[0]||s[0]||0,d=l[1]||s[1]||1,u=e.map,p=e.tile,h=d3.geoMercator();p.show&&d3.tile?(e.zoomable=!1,p.size=[n,i],p.center=p.center||u.center,p.scale=Math.max(p.scale,n),h.scale(1/(2*Math.PI)).translate([0,0]).center([0,0])):h=d3[e.projection]().scale(i*u.scale).translate(u.translate||[0,0]).rotate(u.rotate||[0,0]).center(u.center);var f=d3.geoPath().projection(h),m=d3.parseGeoData(u,{data:t,neighbors:!0}),g=m.features,y=m.neighbors,v=e.coloring,x=e.colorScale,k=e.colorScheme,b=d3.scaleOrdinal(k);if("scaleSequential"===x)b=d3.scaleSequential(k);else if("scaleThreshold"===x){var w=e.thresholds||[];if(!w.length){var A=e.levels,z=(d-c)/A;w=d3.range(A).map(function(t){return z*t+c})}b=d3.scaleThreshold().domain(w).range(k)}if("svg"===a){var S=d3.createPlot(r,e),M=S.select(".container");if(p.show&&d3.tile){var W=h(p.center),O=d3.zoomIdentity.translate(n/2,i/2).scale(p.scale).translate(-W[0],-W[1]),C=d3.zoom().scaleExtent(p.scaleExtent).on("zoom",function(){var t=d3.event.transform;p.scale=t.k,p.translate=[t.x,t.y],d3.setTiles(S.select(".tile"),p),h.scale(p.scale/(2*Math.PI)).translate(p.translate),M.selectAll(".region").attr("d",f),M.selectAll(".dot").attr("cx",function(t){return h(t.coordinates)[0]}).attr("cy",function(t){return h(t.coordinates)[1]})});M.attr("transform",d3.translate(0,0)),S.insert("g",":first-child").attr("class","tile"),S.call(C).call(C.transform,O),p.zoomable===!1&&C.on("zoom",null)}var P=e.graticules;if(P.show){var j=d3.geoGraticule().step(P.step).precision(P.precision);M.append("path").datum(j).attr("class","graticule").attr("d",f).attr("stroke",P.stroke)}var Y=e.regions;if(Y.show){var o=Y.fill;M.append("g").attr("class","layer").selectAll(".region").data(g).enter().append("path").attr("class","region").attr("d",f).attr("stroke",Y.stroke).attr("fill",function(t,e){return t.color?t.color:"none"===o?o:("topological"===v&&y.length?t.value=(0|d3.max(y[e],function(t){return g[t].value}))+1:t.value=t.data.value,void 0===t.value||null===t.value?o:("scaleSequential"===x&&(t.value=(t.value-c)/d),b(t.value)))}).attr("opacity",Y.opacity)}var $=e.labels;if($.show&&M.selectAll(".label").data(g).enter().append("text").attr("class","label").attr("x",function(t){return t.center=f.centroid(t),t.center[0]}).attr("y",function(t){return t.center[1]}).attr("dy",$.dy).attr("text-anchor","middle").attr("stroke",$.stroke).attr("fill",$.fill).attr("font-size",$.fontSize).attr("opacity",$.opacity).text($.text),e.zoomable){var D=h.scale(),I=h.translate(),C=d3.zoom().scaleExtent(e.scaleExtent).on("zoom",function(t){var e=d3.event.transform;h.scale(e.k*D).translate([I[0]+e.x,I[1]+e.y]),M.selectAll(".graticule").attr("d",f),M.selectAll(".region").attr("d",f),M.selectAll(".dot").attr("cx",function(t){return h(t.coordinates)[0]}).attr("cy",function(t){return h(t.coordinates)[1]}),M.selectAll(".label").attr("x",function(t){return t.center=f.centroid(t),t.center[0]}).attr("y",function(t){return t.center[1]})});S.attr("cursor","move").call(C)}var T=e.tooltip;T.target=M.selectAll(".region"),d3.setTooltip(r,T)}},d3.components.bubbleMap={type:"bubble map",schema:{type:"object",entries:[{key:"id",type:"string",aliases:["adcode","city","code","county","country","district","name","province","state"]},{key:"value",type:"number",aliases:["count","percentage","ratio"]},{key:"lng",type:"number",aliases:["lon","longitude"]},{key:"lat",type:"number",aliases:["latitude"]}]},sort:null,projection:"geoMercator",tile:{show:!1,scale:512},dots:{scale:"0.5%",minRadius:2,maxRadius:1/0,stroke:"#fff",opacity:.8},labels:{show:!1},tooltip:{html:function(t){return t.id+": "+t.value}}},d3.bubbleMap=function(t,e){t=d3.parseData("bubbleMap",t),e=d3.parseOptions("bubbleMap",e);var r=(d3.dispatch("init","update","finalize"),e.chart),a=e.renderer,n=(e.context,e.width),i=e.height,o=(e.stroke,e.strokeWidth,e.colorScheme),l=(e.fontSize,e.lineHeight,e.domain||[]),s=d3.extent(t,function(t){return t.value}),c=l[0]||s[0]||0,d=l[1]||s[1]||1,u=e.map,p=e.tile,h=d3.geoMercator();if(p.show&&d3.tile?(p.size=[n,i],p.center=p.center||u.center,p.scale=Math.max(p.scale,n),h.scale(1/(2*Math.PI)).translate([0,0]).center([0,0])):h=d3[e.projection]().scale(i*u.scale).translate(u.translate||[0,0]).center(u.center),t=d3.parseGeoData(u,{data:t,mixin:!0}),"svg"===a){var f=d3.createPlot(r,e),m=f.select(".container");if(p.show&&d3.tile){var g=h(p.center),y=d3.zoomIdentity.translate(n/2,i/2).scale(p.scale).translate(-g[0],-g[1]),v=d3.zoom().on("zoom",function(){var t=d3.event.transform;p.scale=t.k,p.translate=[t.x,t.y],h.scale(p.scale/(2*Math.PI)).translate(p.translate),m.selectAll(".dot").attr("cx",function(t){return h(t.coordinates)[0]}).attr("cy",function(t){return h(t.coordinates)[1]})});m.call(v).call(v.transform,y),v.on("zoom",null)}var x=d3.scaleOrdinal(o),k=e.dots,b=k.scale,w=k.minRadius,A=k.maxRadius,z=(m.append("g").attr("class","layer").attr("stroke",k.stroke).attr("opacity",k.opacity).selectAll(".dot").data(t).enter().append("circle").attr("class","dot").each(function(t){t.coordinates=t.coordinates||[t.lng,t.lat]}).attr("cx",function(t){return h(t.coordinates)[0]}).attr("cy",function(t){return h(t.coordinates)[1]}).attr("r",function(t){var e=0;return A!==1/0&&A?A>w&&(e=Math.sqrt((t.value-c)/(d-c))*(A-w)):e=Math.sqrt(t.value/d)*b,e+w}).attr("fill",function(t){return x(t.value)}).sort(function(t,e){return e.value-t.value}),e.tooltip);z.target=m.selectAll(".dot"),d3.setTooltip(r,z)}},d3.components.contourPlot={type:"contour plot",schema:{type:"object",entries:[{key:"x",type:"number",aliases:["lng","longitude"]},{key:"y",type:"number",aliases:["lat","latitude"]},{key:"z",type:"number",aliases:["count","percentage","ratio","value"]}]},colorScale:"scaleOrdinal",contours:{number:10,smooth:!0,density:1},tooltip:{html:function(t){var e=Number(t.value.toFixed(3));return d3.format(".3")(e)}}},d3.contourPlot=function(t,e){t=d3.parseData("contourPlot",t),e=d3.parseOptions("contourPlot",e);var r=(d3.dispatch("init","update","finalize"),e.chart),a=e.renderer,n=(e.context,e.width,e.height,e.innerWidth),i=e.innerHeight,o=e.margin,l=(e.stroke,e.strokeWidth,e.fontSize,e.lineHeight,e.contours),s=l.density,c=l.size||[],d=c[0]||Math.round(n*s),u=c[1]||Math.round(i*s),p=l.scale||i/u,h=e.domainX,f=e.domainY,m=d3.type(t),g=[];if("function"===m){var y=1/d,v=1/u,x=h[1]-h[0],k=f[1]-f[0];d3.range(v/2,1,v).forEach(function(e){d3.range(y/2,1,y).forEach(function(r){var a=h[0]+r*x,n=f[1]-e*k;g.push(t(a,n))})})}else"array"===m&&(t.sort(function(t,e){return d3.descending(t.y,e.y)||d3.ascending(t.x,e.x)}),g=t.map(function(t){return t.z||t}));var b=d3.scaleLinear().domain(h).rangeRound([0,n]).nice(),w=d3.scaleLinear().domain(f).rangeRound([i,0]).nice(),A=d3.extent(g),z=e.thresholds;if("array"!==d3.type(z)){var S=A[0],M=A[1],W=(M-S)/l.number;z=d3.range(S,M,W)}var O=e.colorScale,C=e.colorScheme,P=d3.scaleOrdinal(C);"scaleSequential"===O&&(P=d3.scaleSequential(C).domain(A));var j=d3.contours().size([d,u]).thresholds(z).smooth(l.smooth);if("svg"===a){var Y=d3.createPlot(r,e),$=Y.select(".container").attr("transform",d3.translate(o.left,o.top));$.append("g").attr("class","contours").attr("transform",function(){var t=n/i/(d/u);return 1===t?null:"scale("+t+",1)"}).selectAll("path").data(j(g)).enter().append("path").attr("class","contour").attr("d",d3.geoPath(d3.geoIdentity().scale(p))).attr("fill",function(t){return P(t.value)}).attr("stroke",l.stroke),d3.setAxes($,{width:n,height:i,scaleX:b,scaleY:w,axisX:e.axisX,axisY:e.axisY,gridX:e.gridX,gridY:e.gridY,framed:e.framed});var D=e.tooltip;D.target=$.selectAll(".contour"),d3.setTooltip(r,D)}},d3.components.mosaicPlot={type:"mosaic plot",schema:{type:"object",entries:[{key:"column",type:"string",aliases:["category"]},{key:"row",type:"string",aliases:["year"]},{key:"value",type:"number",aliases:["count","percentage","ratio"]},{key:"series",type:"string",aliases:["group","type"],optional:!0}]},coloring:"series",scaleX:{uniform:!1,paddingInner:.1,paddingOuter:0,paddingMidst:0},scaleY:{uniform:!1,paddingInner:.1,paddingOuter:0},scaleZ:{uniform:!1,independent:!1,paddingMidst:0},labels:{show:!1,stroke:"none",fill:"#fff",fontSize:"3%",minWidth:"6%",minHeight:"3%",text:function(t){return t.value}},tooltip:{html:function(t){var e="column = "+t.column+"<br/>row = "+t.row;return t.series&&(e+="<br/>series = "+t.series),e+"<br/>value = "+t.value}}},d3.mosaicPlot=function(t,e){t=d3.parseData("mosaicPlot",t),e=d3.parseOptions("mosaicPlot",e);var r=(d3.dispatch("init","update","finalize"),e.chart),a=e.renderer,n=(e.context,e.width,e.height,e.innerWidth),i=e.innerHeight,o=e.margin,l=e.stroke,s=(e.strokeWidth,e.colorScheme),c=(e.fontSize,e.lineHeight),d=e.rows||[],u=e.columns||[],p=e.series||[];d.length||(d=d3.set(t,function(t){return t.row}).values()),u.length||(u=d3.set(t,function(t){return t.column}).values()),p.length||(p=d3.set(t,function(t){return t.series}).values());var h=e.scaleX,f=e.scaleY,m=e.scaleZ,g=d3.scaleBand().domain(u).range([0,n]).paddingInner(h.paddingInner).paddingOuter(h.paddingOuter),y=d3.scaleBand().domain(d).range([0,i]).paddingInner(f.paddingInner).paddingOuter(f.paddingOuter),v=d3.map(),x=h.uniform;if(!x){var k=0,b=u.map(function(e){return d3.sum(t,function(t){return t.column===e?t.value:0})}),w=d3.mean(b);u.forEach(function(t,e){var r=b[e]/w;v.set(t,{ratio:r,offset:k}),k+=r-1})}var A=d3.map(),z=f.uniform,S=m.uniform,M=m.independent;if(!z){var W=0,O=0,C=d.map(function(e){return d3.sum(t,function(t){return t.row===e?t.value:0})}),P=d3.mean(C);d.forEach(function(e,r){var a=C[r]/P,n=t.filter(function(t){return t.row===e}),i=p.map(function(t){return d3.sum(n,function(e){return String(e.series)===t?e.value:0})}),o=d3.mean(i);p.forEach(function(t,r){var n=a*(S?1:i[r]/o);A.set(e+"."+t,{ratio:n,offset:W}),W+=n-1}),0===r&&(O=W),M||u.forEach(function(t){var r=O-W,i=n.filter(function(e){return e.column===t}),o=p.map(function(t){return d3.sum(i,function(e){return String(e.series)===t?e.value:0})}),l=d3.mean(o);p.forEach(function(n,i){var s=a*(S?1:o[i]/l);A.set(e+"."+t+"."+n,{ratio:s,offset:r}),r+=s-1})})})}var j=e.coloring,Y=d3.scaleOrdinal().range(s);if("row"===j?Y.domain(d):"column"===j?Y.domain(u):"series"===j&&Y.domain(p),"svg"===a){var $=d3.createPlot(r,e),D=$.select(".container").attr("transform",d3.translate(o.left,o.top)),I=g.bandwidth(),T=y.bandwidth()/p.length,X=T*m.paddingMidst;D.selectAll(".mosaic").data(t).enter().append("g").attr("class","mosaic").attr("transform",function(t){var e=p.indexOf(t.series),r=(M?"":"."+t.column)+"."+t.series,a=x?0:v.get(t.column).offset,n=z?0:A.get(t.row+r).offset;return t.x=t.x||g(t.column)+I*a,t.y=t.y||y(t.row)+T*n,e!==-1&&(t.y+=(T+X)*e),d3.translate(t.x,t.y)}).append("rect").attr("x",0).attr("y",0).attr("width",function(t){var e=x?1:v.get(t.column).ratio;return t.width=t.width||I*e,t.width}).attr("height",function(t){var e=(M?"":"."+t.column)+"."+t.series,r=z?1:A.get(t.row+e).ratio;return t.height=(t.height||T*r)-X,t.height}).attr("stroke",l).attr("fill",function(t){return t.color=t.color||Y(t[j]),t.color});var H=e.labels;if(H.show){var R=H.minWidth,E=H.minHeight;D.selectAll(".mosaic").append("text").attr("x",function(t){return t.width/2}).attr("y",function(t){return t.height/2+c/4}).attr("text-anchor","middle").attr("stroke",H.stroke).attr("fill",H.fill).attr("font-size",H.fontSize).attr("display",function(t){return t.width<R||t.height<E?"none":"block"}).text(H.text)}var N=e.tooltip;N.target=D.selectAll(".mosaic"),d3.setTooltip(r,N)}},d3.components.terrestrialGlobe={type:"terrestrial globe",schema:{type:"object",entries:[{key:"id",type:"string",aliases:["country","nation"]},{key:"value",type:"number",aliases:["count","percentage","ratio"]},{key:"series",type:"string",aliases:["group","type"],optional:!0}]},levels:5,projection:"geoOrthographic",coloring:"ordinal",colorScale:"scaleOrdinal",sphere:{show:!0,stroke:"none",fill:"#1f77b4"},graticules:{show:!1,step:[10,10],precision:1,stroke:"#ccc"},regions:{show:!0,stroke:"#666",fill:"#fff"},tooltip:{html:function(t){return t.data.id+": "+t.data.value}},rotation:{enable:!0,autoplay:!1,sensitivity:.25,velocity:[.01,0,0]},colorScheme:d3.schemeCategory20c},d3.terrestrialGlobe=function(t,e){t=d3.parseData("terrestrialGlobe",t),e=d3.parseOptions("terrestrialGlobe",e);var r=(d3.dispatch("init","update","finalize"),e.chart),a=(e.id,e.renderer),n=(e.context,e.width),i=e.height,o=(e.stroke,e.fill),l=(e.strokeWidth,e.fontSize,e.lineHeight,e.map),s=l.center||[0,0],c=Math.min(n,i)/2,d=d3[e.projection]().scale(l.scale*c).translate(l.translate||[0,0]).rotate(l.rotate||[-s[0],-s[1]]).clipAngle(90),u=d3.geoPath().projection(d),p=d3.parseGeoData(l,{data:t,neighbors:!0}),h=p.features,f=p.neighbors,m=e.coloring,g=e.colorScale,y=e.colorScheme,v=d3.scaleOrdinal(y);if("scaleSequential"===g)v=d3.scaleSequential(y);else if("scaleThreshold"===g){var x=e.thresholds||[];if(!x.length){var k=e.levels,b=(max-min)/k;x=d3.range(k).map(function(t){return b*t+min})}v=d3.scaleThreshold().domain(x).range(y)}if("svg"===a){var w=d3.createPlot(r,e),A=w.select(".container"),z=e.sphere;z.show&&A.append("g").attr("class","layer").append("path").datum({type:"Sphere"}).attr("class","sphere").attr("d",u).attr("stroke",z.stroke).attr("stroke-width",z.strokeWidth).attr("fill",z.fill);var S=e.graticules;if(S.show){var M=d3.geoGraticule().step(S.step).precision(S.precision);A.append("g").attr("class","layer").append("path").datum(M).attr("class","graticule").attr("d",u).attr("stroke",S.stroke).attr("fill","none")}var W=e.regions;if(W.show){var o=W.fill;A.append("g").attr("class","layer").selectAll(".region").data(h).enter().append("path").attr("class","region").attr("d",u).attr("stroke",W.stroke).attr("fill",function(t,e){return t.color?t.color:"none"===o?o:("topological"===m&&f.length?t.value=(0|d3.max(f[e],function(t){return h[t].value}))+1:t.value=t.data.value,void 0===t.value||null===t.value?o:("scaleSequential"===g&&(t.value=(t.value-min)/max),v(t.value)))}).attr("opacity",W.opacity)}var O=e.rotation;if(O.enable)if(O.autoplay){var C=O.velocity;d3.timer(function(t){var e=C.map(function(e){return e*t});d.rotate(e),A.selectAll(".graticule").attr("d",u),A.selectAll(".region").attr("d",u)})}else{var P=O.sensitivity,j=d3.drag().subject(function(){var t=d.rotate();return{x:t[0]/P,y:-t[1]/P}}).on("drag",function(){var t=[d3.event.x*P,-d3.event.y*P,d.rotate()[2]];d.rotate(t),A.selectAll(".graticule").attr("d",u),A.selectAll(".region").attr("d",u)});A.select(".sphere").call(j)}var Y=e.tooltip;Y.target=A.selectAll(".region"),d3.setTooltip(r,Y)}},d3.components.treeDiagram={type:"tree diagram",schema:{type:"object",entries:[{key:"label",type:"string",aliases:["name"]},{key:"parent",type:"string",aliases:["category"]},{key:"value",type:"number",aliases:["count","percentage","ratio"],optional:!0},{key:"image",type:"string",aliases:["icon","img","logo","photo","picture"],optional:!0}]},hierarchy:{root:!0,collapsed:!1,successive:!1,separation:function(t,e){return t.parent==e.parent?1:2}},curves:{stroke:"currentColor",fill:"none",arrow:{show:!1,size:"1.5%",stroke:"currentColor",strokeWidth:0,fill:"currentColor"}},vertices:{show:!0,radius:"0.5%",width:"5%",height:"2%",stroke:"#1f77b4",strokeWidth:1,fill:"#1f77b4",cursor:"pointer"},labels:{show:!0,dx:"1.5%",dy:"0.5%",stroke:"none",fill:"currentColor",fontSize:"0.85em",maxWidth:"5.1em"},images:{show:!1,maxWidth:"6%",maxHeight:"4%"},tooltip:{html:function(t){return t.data.parent+" &rarr; "+t.data.label}},margin:{top:"2em",right:"6em",bottom:"2em",left:"6em"}},d3.treeDiagram=function(t,e){t=d3.parseData("treeDiagram",t),e=d3.parseOptions("treeDiagram",e);var r=d3.dispatch("init","update","finalize"),a=e.chart,n=e.renderer,i=(e.context,e.width,e.height,e.innerWidth),o=e.innerHeight,l=e.margin,s=(e.stroke,e.strokeWidth,e.colorScheme,e.fontSize,e.lineHeight),c=e.hierarchy,d=d3.stratify().id(function(t){return t.label}).parentId(function(t){return t.parent}),u=d3.tree().size([o,i]).separation(c.separation),p=d3.linkHorizontal().x(function(t){return t.y}).y(function(t){return t.x});if(c.collapsed){var h="";t.some(function(t){return!t.parent&&(h=t.label,!0)}),t.forEach(function(t){if(t.parent){var e=t.parent===h;t.collapsed=e,t.display=e?"block":"none"}else t.collapsed=!1,t.display="block"})}if("svg"===n){var f=d3.createPlot(a,e),m=f.select(".container").attr("transform",d3.translate(l.left,l.top));r.on("init.links",function(t){var r=e.curves,n=m.selectAll(".link").data(u(t).links());n.exit().remove(),n.enter().append("path").attr("class","link").merge(n).attr("d",p).attr("stroke",r.stroke).attr("stroke-width",r.strokeWidth).attr("fill",r.fill).attr("display",function(t){return t.target.data.display}),c.root||m.selectAll(".link").filter(function(t){return!t.source.parent}).attr("display","none"),d3.setArrows(a,{arrow:r.arrow,path:m.selectAll(".link")})}),r.on("init.nodes",function(e){var a=c.successive,n=m.selectAll(".node").data(e.descendants());n.exit().remove(),n.enter().append("g").attr("class",function(t){return"node"+(t.parent?"":" node-root")+(t.children?" node-branch":" node-leaf")}).merge(n).attr("transform",function(t){return d3.translate(t.y,t.x)}).attr("display",function(t){return t.data.display}),m.selectAll(".node-branch").on("click",function(e){var n=e.depth+1,i=(e.data.label,!e.data.collapsed),o=e.descendants(),l=o.map(function(t){return t.data.label});t.forEach(function(t){var e=l.indexOf(t.label);if(e!==-1)if(i||!a)t.collapsed=i,t.display=i&&e?"none":"block";else{var r=o[e];r.depth<=n&&(t.collapsed=r.children&&e,t.display="block")}}),r.call("init",this,d(t)),r.call("update",this,m.selectAll(".node"))})}),r.on("update.vertices",function(t){var r=e.vertices;if(r.show){var a=r.radius,n=t.select(".vertex");n.empty()&&(n=t.append("circle").attr("class","vertex").attr("cx",0).attr("cy",0)),n.attr("r",function(t){return t.data.radius||a}).attr("stroke",r.stroke).attr("stroke-width",r.strokeWidth).attr("fill",function(t){return t.data.collapsed?r.fill:"#fff"}),t.filter(".node-branch").attr("cursor",r.cursor),c.root||t.filter(".node-root").attr("display","none")}}),r.on("update.labels",function(t){var r=e.labels;if(r.show){var a=r.dx,n=r.dy+s/12,i=r.textAnchor,o=r.maxWidth,l=t.select(".label");l.empty()&&(l=t.append("text").attr("class","label")),l.text(function(t){return t.data.label}).attr("dx",function(t){return t.data.dx||(t.children&&!t.data.collapsed?t.parent?0:-a:a)}).attr("dy",function(t){return t.data.dy||(t.parent&&t.children&&!t.data.collapsed?4:1)*n}).attr("text-anchor",function(t){return t.data.textAnchor||i||t.children&&!t.data.collapsed?t.parent?"middle":"end":"start"}).attr("stroke",r.stroke).attr("fill",r.fill).attr("font-size",r.fontSize).attr("lengthAdjust","spacingAndGlyphs").attr("textLength",function(t){var e=d3.select(this).node().getComputedTextLength();return e>o?o:null})}}),r.on("update.images",function(t){var r=e.labels,a=e.images,n=a.maxWidth,i=a.maxHeight,o=e.vertices,l=o.radius+o.strokeWidth;if(a.show){var s=t.select(".icon");s.empty()&&(s=t.append("image").attr("class","icon")),s.attr("href",function(t){return t.data.width=i*(t.data.width/t.data.height)||n,t.data.height=Math.min(t.data.height||1/0,i),t.data.image}).attr("width",function(t){return t.data.width}).attr("height",function(t){return t.data.height}).attr("x",function(t){var e=-t.data.width/2;return r.show?2*e+l:e}).attr("y",function(t){var e=-t.data.height/2;return e})}}),r.on("update.tooltip",function(t){var r=e.tooltip;r.target=t,d3.setTooltip(a,r)}),r.call("init",this,d(t)),r.call("update",this,m.selectAll(".node"))}},d3.components.timelineDiagram={type:"timeline diagram",schema:{type:"object",entries:[{key:"date",type:"date",aliases:["time","year"]},{key:"text",type:"string",aliases:["content","info","name"]},{key:"image",type:"string",aliases:["icon","img","logo","photo","picture"]}]},sort:"ascending(date)",scale:"scaleTime",axis:{show:!0,label:!0,nice:!1,format:"%Y",stroke:"currentColor",strokeWidth:1,fill:"currentColor",fontSize:"0.5em",domain:{show:!0,stroke:"currentColor",strokeWidth:1},ticks:{number:8,sizeInner:0,sizeOuter:0,padding:4,format:""}},items:{stroke:"currentColor",strokeWidth:1,fill:"currentColor",fontSize:"0.65em"},connectors:{dx:0,dy:"3.5%",stroke:"currentColor",strokeWidth:1},dots:{radius:"0.5%",stroke:"#1f77b4",strokeWidth:1,fill:"#fff"},images:{maxWidth:"6%",maxHeight:"6%"},tooltip:{html:function(t){return d3.timeFormat("%Y-%m-%d")(t.date)}}},d3.timelineDiagram=function(t,e){t=d3.parseData("timelineDiagram",t),e=d3.parseOptions("timelineDiagram",e);var r=(d3.dispatch("init","update","finalize"),e.chart),a=e.renderer,n=(e.context,e.width,e.height,e.innerWidth),i=e.innerHeight,o=e.margin,l=(e.stroke,e.strokeWidth,e.colorScheme),s=e.fontSize,c=e.lineHeight,d=e.domain;Array.isArray(d)&&d.length?(d=d.map(function(t){return new Date(t)}),t=t.filter(function(t){return t.date>=d[0]&&t.date<d[1]})):d=d3.extent(t,function(t){return t.date}),"function"===d3.type(e.sort)&&t.sort(e.sort),"scalePoint"===e.scale&&(d=t.map(function(t){return t.date}));var u=e.axis,p=d3[e.scale]().domain(d).rangeRound([0,n]);if(u.nice&&p.nice(),"svg"===a){var h=d3.createPlot(r,e),f=h.select(".container").attr("transform",d3.translate(o.left,o.top)),m=e.origin||[0,i/2],g=m[0],y=m[1];if(d3.setAxes(f,{width:n,height:y,scaleX:p,axisX:u}),u.label){var v=d3.timeFormat(u.format);f.append("text").attr("class","label").attr("x",g-s/2).attr("y",y+c/8).attr("font-size",u.fontSize).attr("fill",u.fill).attr("text-anchor","end").text(v(d[0])),f.append("text").attr("class","label").attr("x",n+s/2).attr("y",y+c/8).attr("font-size",u.fontSize).attr("fill",u.fill).attr("text-anchor","start").text(v(d[1]))}var x=e.items,k=e.images,b=k.maxWidth,w=k.maxHeight,A=e.connectors,z=A.dx,S=A.dy,M=[0,0],W=[S,S];f.selectAll(".item").data(t).enter().append("g").attr("class","item").attr("transform",function(t,e){var r=e%2,a=p(t.date),n=W[r];return t.width=w*(t.width/t.height)||b,t.height=Math.min(t.height||1/0,w),e>1&&M[r]+t.width>a?n+=2*S+t.height:n=S,M[r]=a,W[r]=n,t.dx=t.hasOwnProperty("dx")?Number(t.dx):z*(n>S?n/S:1),t.dy=t.hasOwnProperty("dy")?Number(t.dy):r?n:-n,d3.translate(a,y)}),f.selectAll(".item").append("line").attr("class","connector").attr("x1",0).attr("y1",0).attr("x2",function(t){return t.dx}).attr("y2",function(t){return t.dy}).attr("stroke",A.stroke).attr("stroke-width",A.strokeWidth),f.selectAll(".item").append("image").attr("href",function(t){
return t.image}).attr("x",function(t){return t.dx-t.width/2}).attr("y",function(t){return t.dy+(t.dy>0?c:-t.height-c)}).attr("width",function(t){return t.width}).attr("height",function(t){return t.height}),f.selectAll(".item").append("text").attr("x",function(t){return t.dx}).attr("y",function(t){return t.dy+c/(t.dy>0?2:-4)}).attr("font-size",x.fontSize).attr("fill",x.fill).attr("text-anchor","middle").text(function(t){return t.text});var O=e.dots,C=O.multicolor;f.selectAll(".item").append("circle").attr("class","knot").attr("cx",0).attr("cy",0).attr("r",O.radius).attr("stroke",function(t,e){return(C?t.color||l[e]:null)||O.stroke}).attr("stroke-width",O.strokeWidth).attr("fill",function(t,e){return(C?t.color||l[e]:null)||O.fill});var P=e.tooltip;P.target=f.selectAll(".knot"),d3.setTooltip(r,P)}},d3.components.liquidFillGauge={type:"liquid-fill gauge",schema:{type:"object",entries:[{key:"name",type:"string",aliases:["category","label"],optional:!0},{key:"value",type:"number",aliases:["percentage","ratio"]}]},sort:null,domain:[0,1],frame:{show:!0,shape:"circle",radius:"60%",round:0,stroke:"#1f77b4",strokeWidth:"1%",fill:"none",fillGap:"1.5%"},wave:{peaks:2,amplitude:.1,phase:90,period:4,asynchrony:1,opacity:.8,animation:{show:!0,direction:"ltr",ease:"easeLinear"}},label:{show:!0,format:".0%",color:"#1f77b4",insideColor:"#fff",fontSize:"8%",fontWeight:"bold"},tooltip:{html:function(t){var e=d3.format(".0%")(t.value);return(t.name?t.name+": ":"")+e}}},d3.liquidFillGauge=function(t,e){t=d3.parseData("liquidFillGauge",t),e=d3.parseOptions("liquidFillGauge",e);var r=(d3.dispatch("init","update","finalize"),e.chart),a=e.renderer,n=(e.context,e.width,e.height),i=(e.innerWidth,e.innerHeight,e.margin,e.stroke,e.strokeWidth,e.colorScheme),o=(e.fontSize,e.lineHeight),l=e.domain;if("function"===d3.type(e.sort)&&t.sort(e.sort),Array.isArray(l)){var s=l[0],c=l[1];t.forEach(function(t){t.value=Math.max(Math.min(t.value,c),s)})}var d=e.frame,u=e.wave,p=d.shape,h=d.round,f=d.strokeWidth,m=Math.min(d.radius,n/2)-f,g=m-d.fillGap,y=g*u.amplitude,v=Math.round(u.peaks),x=u.asynchrony,k=t.map(function(t,e){return(e+1)*y*v*x+g}),b=d3.scaleLinear().domain([0,1]).range([-g,g]),w=d3.scaleLinear().domain([-1,1]).range([y,-y]),A=t.map(function(t,e){var r=k[e];return d3.scaleLinear().domain([0,1]).range([-r,r])}),z=t.map(function(t,e){return d3.area().x(function(t){return 4*A[e](t.x)}).y0(g).y1(function(e){return w(e.y)-b(t.value)})}),S=Math.PI*u.phase/180,M=8*Math.PI*v,W=1/(240*v),O=d3.range(0,1+W/2,W);if("svg"===a){var C=d3.createPlot(r,e),P=C.select(".container"),j=C.select("defs");j.empty()&&(j=C.insert("defs",":first-child"));var Y=j.selectAll(".wave").data(t);Y.exit().remove(),Y.enter().append("clipPath").attr("class","wave").append("path");var $=e.id+"-clip-path",D=j.selectAll(".wave").attr("id",function(t,e){return $+"-"+e}),I=D.select("path");I.empty()&&(I=D.append("path")),I.attr("d",function(t,e){return z[e](O.map(function(t){return{x:t,y:Math.sin(M*t+S*(e+1))}}))});var T=function(t,e){if(t.selectAll(".shape").attr("display","none"),"circle"===p){var r=t.select("circle");r.empty()&&(r=t.append("circle").attr("class","shape").attr("cx",0).attr("cy",0)),r.attr("r",e).attr("display","block")}else if("rect"===p){var a=e*h,n=t.select("rect");n.empty()&&(n=t.append("rect").attr("class","shape")),n.attr("width",2*e).attr("height",2*e).attr("x",-e).attr("y",-e).attr("rx",a).attr("ry",a).attr("display","block")}};if(d.show){var X=P.select(".frame");X.empty()&&(X=P.append("g").attr("class","frame")),X.attr("stroke",d.stroke).attr("stroke-width",f).attr("fill",d.fill).call(T,m)}var H=P.selectAll(".liquid").data(t);H.exit().remove(),H.enter().append("g").attr("class","liquid").call(T,g);var R=P.selectAll(".liquid");R.call(T,g).attr("fill",function(t,e){return t.color||i[e]}).attr("clip-path",function(t,e){return"url(#"+$+"-"+e+")"}).selectAll(".shape").attr("stroke-width",0).attr("opacity",u.opacity);var E=e.label;if(E.show){var N=P.select(".label"),L=t.length?t[0].value:0;N.empty()&&(P.append("text").attr("class","label"),P.append("text").attr("class","label label-clip")),P.selectAll(".label").attr("stroke","none").attr("text-anchor","middle").attr("fill",E.color).attr("font-size",E.fontSize).attr("font-weight",E.fontWeight).attr("dy",function(){var t=E.position||L;return g*(1-2*t)+o/4}).text(function(){return d3.format(E.format)(L)}),P.select(".label-clip").attr("fill",E.insideColor).attr("clip-path",function(){return"url(#"+$+"-0)"})}var q=u.animation;if(I.interrupt().transition(),q.show){var G=q.direction,F=1e3*u.period,V=q.ease,B=d3.translate(0,0),Z=function(t,e){return d3.translate(2*k[e],0)},J=function(t){t.attr("transform","ltr"===G?B:Z).transition().duration(F).ease(d3[V]).attr("transform","ltr"===G?Z:B).on("end",function(){J(t)})};I.call(J)}var Q=e.tooltip;Q.target=P.selectAll(".liquid"),d3.setTooltip(r,Q)}};